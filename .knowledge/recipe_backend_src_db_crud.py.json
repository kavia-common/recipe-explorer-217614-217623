{"is_source_file": true, "format": "Python", "description": "This file contains database CRUD operations related to User and SavedRecipe models, including functions for creating, retrieving, updating, and deleting saved recipes, as well as user lookup. It also handles password hashing with a fallback stub if the secure hash function isn't available.", "external_files": ["sqlalchemy", "src.api.auth", "models", "schemas"], "external_methods": ["select", "IntegrityError", "Session.execute", "Session.add", "Session.commit", "Session.refresh", "Session.rollback", "Session.delete"], "published": ["get_user_by_email", "create_user", "list_saved", "upsert_saved", "remove_saved"], "classes": [], "methods": [{"name": "str _hash_password_stub(plain_password: str)", "description": "Provides a fallback password hashing implementation that reverses the plain password string.", "scope": "", "scopeKind": ""}, {"name": "Optional[models.User] get_user_by_email(db: Session, email: str)", "description": "Retrieves a user by email from the database, returning None if not found.", "scope": "", "scopeKind": ""}, {"name": "models.User create_user(db: Session, user_in: schemas.UserCreate)", "description": "Creates a new user with a hashed password, adding it to the database and refreshing the user object.", "scope": "", "scopeKind": ""}, {"name": "List[models.SavedRecipe] list_saved(db: Session, user_id: int)", "description": "Lists all saved recipes associated with a specific user ID.", "scope": "", "scopeKind": ""}, {"name": "models.SavedRecipe upsert_saved(db: Session, user_id: int, data: schemas.SavedRecipeCreate)", "description": "Inserts or updates a saved recipe for a user; handles race conditions by re-selecting and updating if a unique constraint violation occurs.", "scope": "", "scopeKind": ""}, {"name": "bool remove_saved(db: Session, user_id: int, recipe_id: int)", "description": "Deletes a saved recipe for a user by recipe ID, returning True if deletion occurred.", "scope": "", "scopeKind": ""}], "calls": ["select(models.User)", "select(models.SavedRecipe)", "db.execute(stmt)", "db.add(user)", "db.commit()", "db.refresh(user)", "db.rollback()", "db.delete(row)"], "search-terms": ["crud", "password hash fallback", "SavedRecipe", "upsert", "get_user_by_email"], "state": 2, "file_id": 8, "knowledge_revision": 26, "git_revision": "d394e6655190d2f490d085f05d63b51d3788d482", "revision_history": [{"18": ""}, {"20": "f9b08eb17e3c40e6f8318d9806eb500f6d851938"}, {"26": "d394e6655190d2f490d085f05d63b51d3788d482"}], "ctags": [{"_type": "tag", "name": "_hash_password_stub", "path": "/home/kavia/workspace/code-generation/recipe-explorer-217614-217623/recipe_backend/src/db/crud.py", "pattern": "/^def _hash_password_stub(plain_password: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(plain_password: str)"}, {"_type": "tag", "name": "_secure_hash_password", "path": "/home/kavia/workspace/code-generation/recipe-explorer-217614-217623/recipe_backend/src/db/crud.py", "pattern": "/^    _secure_hash_password = None  # fallback to stub below$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_secure_hash_password", "path": "/home/kavia/workspace/code-generation/recipe-explorer-217614-217623/recipe_backend/src/db/crud.py", "pattern": "/^    from src.api.auth import get_password_hash as _secure_hash_password  # type: ignore$/", "language": "Python", "kind": "unknown", "nameref": "unknown:get_password_hash"}, {"_type": "tag", "name": "create_user", "path": "/home/kavia/workspace/code-generation/recipe-explorer-217614-217623/recipe_backend/src/db/crud.py", "pattern": "/^def create_user(db: Session, user_in: schemas.UserCreate) -> models.User:$/", "language": "Python", "typeref": "typename:models.User", "kind": "function", "signature": "(db: Session, user_in: schemas.UserCreate)"}, {"_type": "tag", "name": "get_user_by_email", "path": "/home/kavia/workspace/code-generation/recipe-explorer-217614-217623/recipe_backend/src/db/crud.py", "pattern": "/^def get_user_by_email(db: Session, email: str) -> Optional[models.User]:$/", "language": "Python", "typeref": "typename:Optional[models.User]", "kind": "function", "signature": "(db: Session, email: str)"}, {"_type": "tag", "name": "list_saved", "path": "/home/kavia/workspace/code-generation/recipe-explorer-217614-217623/recipe_backend/src/db/crud.py", "pattern": "/^def list_saved(db: Session, user_id: int) -> List[models.SavedRecipe]:$/", "language": "Python", "typeref": "typename:List[models.SavedRecipe]", "kind": "function", "signature": "(db: Session, user_id: int)"}, {"_type": "tag", "name": "remove_saved", "path": "/home/kavia/workspace/code-generation/recipe-explorer-217614-217623/recipe_backend/src/db/crud.py", "pattern": "/^def remove_saved(db: Session, user_id: int, recipe_id: int) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "(db: Session, user_id: int, recipe_id: int)"}, {"_type": "tag", "name": "upsert_saved", "path": "/home/kavia/workspace/code-generation/recipe-explorer-217614-217623/recipe_backend/src/db/crud.py", "pattern": "/^def upsert_saved(db: Session, user_id: int, data: schemas.SavedRecipeCreate) -> models.SavedReci/", "language": "Python", "typeref": "typename:models.SavedRecipe", "kind": "function", "signature": "(db: Session, user_id: int, data: schemas.SavedRecipeCreate)"}], "hash": "0ba8076cd1dfb14a25638f4334bb1093", "format-version": 4, "code-base-name": "recipe_backend", "filename": "recipe_backend/src/db/crud.py", "fields": [{"name": "_secure_hash_password = None  # fallback to stub below", "scope": "", "scopeKind": "", "description": "unavailable"}]}